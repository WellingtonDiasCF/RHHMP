{% load static %}
<!DOCTYPE html>
<html lang="pt-br" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light">
    <title>Meus Atestados | Portal RH</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            color-scheme: light;
        }
        body {
            background-color: #f4f6f9;
            font-family: 'Inter', sans-serif;
            color: #333;
            min-height: 100vh;
        }

        .navbar-custom {
            background: linear-gradient(to right, #1a1a1a, #333);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .page-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .header-box {
            background: #fff;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        @media (max-width: 768px) {
            .header-box {
                flex-direction: column;
                align-items: stretch;
                text-align: center;
            }
            .header-box .d-flex {
                justify-content: center;
            }
        }

        /* Tabela Responsiva */
        .table-custom thead th {
            background-color: #f8fafc;
            color: #64748b;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            padding: 15px 20px;
            border-bottom: 2px solid #e2e8f0;
            white-space: nowrap; /* Evita quebra de linha no cabeçalho */
        }
        
        .table-custom tbody td {
            padding: 15px 20px;
            vertical-align: middle;
            border-bottom: 1px solid #f1f5f9;
            background: #fff;
            white-space: nowrap; /* Mantém linhas uniformes no scroll horizontal */
        }

        .badge-soft-success { background-color: #d1fae5; color: #065f46; border: 1px solid #a7f3d0; }
        .badge-soft-warning { background-color: #fef3c7; color: #92400e; border: 1px solid #fde68a; }
        .badge-soft-danger { background-color: #fee2e2; color: #b91c1c; border: 1px solid #fecaca; }
        .badge-soft-primary { background-color: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; }
        .badge-soft-info { background-color: #cffafe; color: #155e75; border: 1px solid #a5f3fc; }

        .btn-check:checked + .btn-outline-primary {
            background-color: #fff5eb;
            border-color: #FF6600;
            color: #FF6600;
            box-shadow: 0 0 0 2px #FF6600;
        }
        .btn-outline-primary { border: 2px solid #e9ecef; color: #6c757d; }
    </style>
<link rel="icon" type="image/svg+xml" href="{% static 'images/icon.svg' %}">
    <link rel="apple-touch-icon" href="{% static 'images/icon.svg' %}">
    <meta name="theme-color" content="#FF6600">
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
        <div class="container-fluid px-4">
            <a class="navbar-brand fw-bold" href="{% url 'home' %}">
                <i class="fas fa-file-invoice-dollar me-2 text-warning"></i> Portal RH <span class="fw-light text-white-50"></span>
            </a>
            <div class="d-flex align-items-center gap-3">
                <span class="text-white small d-none d-md-block">Olá, {{ request.user.first_name }}</span>
                <a href="{% url 'home' %}" class="btn btn-sm btn-outline-light rounded-pill px-3">Início</a>
            </div>
        </div>
    </nav>

    <div class="page-container">
        
        <div class="header-box">
            <div>
                <h3 class="fw-bold text-dark mb-1">Meus Atestados</h3>
                <p class="text-muted small mb-0">Gerencie seus envios de atestados médicos e declarações.</p>
            </div>
            <div class="d-flex gap-2">
                <a href="{% url 'home' %}" class="btn btn-outline-secondary rounded-pill px-4 fw-bold shadow-sm">Voltar</a>
                <button class="btn btn-warning text-dark fw-bold rounded-pill px-4 shadow-sm" data-bs-toggle="modal" data-bs-target="#modalNovoAtestado">
                    <i class="fas fa-plus-circle me-2"></i> Novo Envio
                </button>
            </div>
        </div>

        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{% if message.tags == 'success' %}success{% else %}danger{% endif %} alert-dismissible fade show shadow-sm rounded-3 border-0 mb-4">
                    <i class="fas fa-info-circle me-2"></i> {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}

        <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
            <div class="table-responsive">
                <table class="table table-custom table-hover mb-0">
                    <thead>
                        <tr>
                            <th class="ps-4">Tipo</th>
                            <th>Data</th>
                            <th>Duração</th>
                            <th class="text-center">Status</th>
                            <th class="text-end pe-4">Arquivo</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in lista %}
                        <tr>
                            <td class="ps-4">
                                {% if item.tipo == 'DIAS' %}
                                    <span class="badge rounded-pill badge-soft-primary px-3 py-2"><i class="fas fa-bed me-1"></i> Afastamento</span>
                                {% else %}
                                    <span class="badge rounded-pill badge-soft-info px-3 py-2"><i class="fas fa-user-clock me-1"></i> Declaração</span>
                                {% endif %}
                            </td>
                            <td class="fw-bold text-dark">{{ item.data_inicio|date:"d/m/Y" }}</td>
                            <td class="text-muted small fw-bold">
                                {% if item.tipo == 'DIAS' %}
                                    {{ item.qtd_dias }} dia(s)
                                {% else %}
                                    {{ item.hora_inicio|time:"H:i" }} às {{ item.hora_fim|time:"H:i" }}
                                {% endif %}
                            </td>
                            <td class="text-center">
                                {% if item.status == 'Aprovado' %}
                                    <span class="badge rounded-pill badge-soft-success px-3 py-2">Aprovado</span>
                                {% elif item.status == 'Recusado' %}
                                    <span class="badge rounded-pill badge-soft-danger px-3 py-2">Recusado</span>
                                {% else %}
                                    <span class="badge rounded-pill badge-soft-warning px-3 py-2">Pendente</span>
                                {% endif %}
                            </td>
                            <td class="text-end pe-4">
                                <a href="{{ item.arquivo.url }}" target="_blank" class="btn btn-sm btn-outline-primary rounded-pill fw-bold px-3 shadow-sm">
                                    <i class="fas fa-eye me-1"></i> Ver
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center py-5 text-muted">
                                <div class="opacity-25 mb-2"><i class="fas fa-file-medical fa-3x"></i></div>
                                <p class="mb-0 fw-bold">Nenhum atestado enviado ainda.</p>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalNovoAtestado" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header border-0 pb-0 pt-4 px-4">
                    <h5 class="modal-title fw-bold text-dark">Enviar Documento</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="row g-2 mb-4">
                            <div class="col-6">
                                <input type="radio" class="btn-check" name="tipo" id="tipoDias" value="DIAS" checked onchange="toggleFormulario()">
                                <label class="btn btn-outline-primary w-100 py-3 rounded-3" for="tipoDias">
                                    <i class="fas fa-bed fa-2x mb-2 d-block"></i> Atestado Médico
                                </label>
                            </div>
                            <div class="col-6">
                                <input type="radio" class="btn-check" name="tipo" id="tipoHoras" value="HORAS" onchange="toggleFormulario()">
                                <label class="btn btn-outline-primary w-100 py-3 rounded-3" for="tipoHoras">
                                    <i class="fas fa-user-clock fa-2x mb-2 d-block"></i> Comparecimento
                                </label>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="fw-bold small mb-1">Data</label>
                            <input type="date" name="data_inicio" class="form-control bg-light border-0 py-2" required>
                        </div>

                        <div id="divDias" class="mb-3">
                            <label class="fw-bold small mb-1">Qtd. Dias</label>
                            <input type="number" name="qtd_dias" class="form-control bg-light border-0 py-2" value="1" min="1">
                        </div>

                        <div id="divHoras" class="mb-3 d-none">
                            <div class="row g-2">
                                <div class="col-6">
                                    <label class="fw-bold small mb-1">Início</label>
                                    <input type="time" name="hora_inicio" class="form-control bg-light border-0 py-2">
                                </div>
                                <div class="col-6">
                                    <label class="fw-bold small mb-1">Fim</label>
                                    <input type="time" name="hora_fim" class="form-control bg-light border-0 py-2">
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="fw-bold small mb-1">Motivo (Opcional)</label>
                            <input type="text" name="motivo" class="form-control bg-light border-0 py-2">
                        </div>

                        <div class="mb-4">
                            <label class="fw-bold small mb-1">Arquivo</label>
                            <input type="file" name="arquivo" class="form-control bg-light border-0" accept=".pdf, .jpg, .jpeg, .png" required>
                        </div>

                        <button type="submit" class="btn btn-warning w-100 py-3 rounded-pill fw-bold shadow-sm">Confirmar Envio</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function toggleFormulario() {
            const isDias = document.getElementById('tipoDias').checked;
            const divDias = document.getElementById('divDias');
            const divHoras = document.getElementById('divHoras');
            const inputQtd = divDias.querySelector('input');
            const inputsHoras = divHoras.querySelectorAll('input');

            if (isDias) {
                divDias.classList.remove('d-none');
                divHoras.classList.add('d-none');
                inputQtd.required = true;
                inputsHoras.forEach(i => i.required = false);
            } else {
                divDias.classList.add('d-none');
                divHoras.classList.remove('d-none');
                inputQtd.required = false;
                inputsHoras.forEach(i => i.required = true);
            }
        }
    </script>
</body>
</html>