<div class="rh-panel-wrapper fade-in-up">
    
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 pb-3 border-bottom gap-3 bg-white p-3 rounded-4 shadow-sm">
        
        <div class="d-flex align-items-center bg-light border rounded-pill p-1">
            <button onclick="filtrarAdminContracheque({{ nav_anterior.mes }}, {{ nav_anterior.ano }})" 
               class="btn btn-sm btn-white rounded-circle shadow-sm" style="width:32px; height:32px;">
               <i class="fas fa-chevron-left text-secondary small"></i>
            </button>
            <div class="px-3 text-center fw-bold text-dark" style="min-width: 140px; font-size: 0.9rem;">
                <i class="far fa-calendar-alt me-2 text-success"></i>{{ nome_mes }} / {{ ano_atual }}
            </div>
            <button onclick="filtrarAdminContracheque({{ nav_proximo.mes }}, {{ nav_proximo.ano }})" 
               class="btn btn-sm btn-white rounded-circle shadow-sm" style="width:32px; height:32px;">
               <i class="fas fa-chevron-right text-secondary small"></i>
            </button>
        </div>

        <div class="d-flex gap-2 align-items-center flex-grow-1 justify-content-end flex-wrap">
            <div class="input-group shadow-sm" style="max-width: 300px;">
                <input type="text" id="contracheque-search-input" class="form-control border-end-0 ps-3 bg-white" placeholder="Buscar funcionário..." 
                       value="{{ q }}" 
                       onkeydown="if(event.key === 'Enter') filtrarAdminContracheque({{ mes_atual }}, {{ ano_atual }})"
                       style="border-top-left-radius: 50px; border-bottom-left-radius: 50px;">
                <button class="btn btn-white border-start-0 text-primary pe-3 bg-white" 
                        onclick="filtrarAdminContracheque({{ mes_atual }}, {{ ano_atual }})"
                        style="border-top-right-radius: 50px; border-bottom-right-radius: 50px;">
                        <i class="fas fa-search"></i>
                </button>
            </div>
            <button class="btn btn-dark rounded-pill px-4 fw-bold shadow-sm" data-bs-toggle="modal" data-bs-target="#modalImportacaoCC">
                <i class="fas fa-cloud-upload-alt me-2"></i> Importar Lote (PDF)
            </button>
        </div>
    </div>

    <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
        <div class="table-responsive">
            <table class="table align-middle mb-0 table-hover">
                <thead class="bg-light">
                    <tr>
                        <th class="ps-4 py-3 text-secondary text-uppercase text-xs fw-bold">Funcionário</th>
                        <th class="text-center py-3 text-secondary text-uppercase text-xs fw-bold">Status Envio (RH)</th>
                        <th class="text-center py-3 text-secondary text-uppercase text-xs fw-bold">Status Assinatura</th>
                        <th class="text-end pe-4 py-3 text-secondary text-uppercase text-xs fw-bold">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in lista_equipe %}
                    <tr>
                        <td class="ps-4">
                            <div class="d-flex flex-column">
                                <span class="fw-bold text-dark">{{ item.funcionario.nome_completo }}</span>
                                <span class="small text-muted">{{ item.funcionario.cargo.titulo|default:"-" }}</span>
                            </div>
                        </td>
                        
                        <td class="text-center">
                            {% if item.enviado %}
                                <span class="badge bg-success-subtle text-success border border-success rounded-pill px-3">
                                    <i class="fas fa-check me-1"></i> Enviado
                                </span>
                            {% else %}
                                <span class="badge bg-light text-secondary border rounded-pill px-3">Não Enviado</span>
                            {% endif %}
                        </td>
                        
                        <td class="text-center">
                            {% if item.assinado %}
                                <span class="badge bg-primary-subtle text-primary border border-primary rounded-pill px-3">
                                    <i class="fas fa-file-signature me-1"></i> Assinado
                                </span>
                                <div class="small text-muted mt-1" style="font-size: 0.75rem;">{{ item.contracheque.data_ciencia|date:"d/m H:i" }}</div>
                            {% else %}
                                <span class="badge bg-warning-subtle text-warning border border-warning rounded-pill px-3">Aguardando</span>
                            {% endif %}
                        </td>
                        
                        <td class="text-end pe-4">
                            <div class="d-flex justify-content-end gap-2 align-items-center">
                                
                                <button type="button" 
                                        class="btn btn-sm btn-outline-primary rounded-pill shadow-sm fw-bold px-3"
                                        onclick="abrirModalIndividual('{{ item.funcionario.nome_completo }}', '{% url 'upload_individual_contracheque' item.funcionario.id %}')">
                                    <i class="fas fa-upload me-1"></i> Anexar
                                </button>

                                {% if item.enviado %}
                                    <a href="{{ item.contracheque.arquivo.url }}" target="_blank" class="btn btn-sm btn-outline-dark rounded-pill fw-bold px-3 shadow-sm" title="Ver PDF">
                                        <i class="fas fa-eye me-1"></i> Ver
                                    </a>

                                    <a href="{% url 'excluir_contracheque' item.contracheque.id %}" 
                                       onclick="return confirm('Tem certeza que deseja apagar o contracheque de {{ item.funcionario.nome_completo }}?')"
                                       class="btn btn-sm btn-outline-danger rounded-pill fw-bold px-3 shadow-sm" title="Excluir">
                                        <i class="fas fa-trash-alt me-1"></i> Excluir
                                    </a>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="4" class="text-center py-5 text-muted">
                        <i class="fas fa-file-invoice-dollar fa-2x mb-3 opacity-25"></i><br>
                        Nenhum registro encontrado para este mês.
                    </td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="modal fade" id="modalImportacaoCC" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold"><i class="fas fa-cloud-upload-alt me-2 text-success"></i> Importar Lote (Todos)</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form method="post" action="{% url 'gerenciar_contracheques' %}" enctype="multipart/form-data">
                        {% csrf_token %}
                        <input type="hidden" name="next" id="input_next_url">
                        <script>document.getElementById('input_next_url').value = window.location.href;</script>
                        
                        <div class="row mb-3">
                            <div class="col-6">
                                <label class="fw-bold small mb-1">Mês</label>
                                <select name="mes_upload" class="form-select bg-light border-0">
                                    {% for m_id, m_nome in meses_choices %}
                                        <option value="{{ m_id }}" {% if m_id == mes_atual %}selected{% endif %}>{{ m_nome }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-6">
                                <label class="fw-bold small mb-1">Ano</label>
                                <input type="number" name="ano_upload" value="{{ ano_atual }}" class="form-control bg-light border-0">
                            </div>
                            <div class="col-12 mt-3">
                                <label class="fw-bold small mb-1">Data Impressa (Opcional)</label>
                                <input type="date" name="data_recebimento" class="form-control bg-light border-0">
                                <div class="form-text small text-muted">A data será escrita no PDF, mas o funcionário ainda precisará confirmar.</div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="fw-bold small mb-1">Arquivo PDF (Geral)</label>
                            <input type="file" name="arquivo_pdf" accept=".pdf" class="form-control bg-light border-0" required>
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-dark rounded-pill py-3 fw-bold">Processar Lote</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalUploadIndividual" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold">
                        <i class="fas fa-user-upload me-2 text-primary"></i> 
                        Anexar: <span id="indiv_nome_func" class="text-dark"></span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="formIndividual" method="post" action="" enctype="multipart/form-data">
                        {% csrf_token %}
                        <input type="hidden" name="mes" value="{{ mes_atual }}">
                        <input type="hidden" name="ano" value="{{ ano_atual }}">

                        <div class="mb-3">
                            <label class="fw-bold small mb-1">Data Impressa (Opcional)</label>
                            <input type="date" name="data_recebimento_individual" class="form-control bg-light border-0">
                            <div class="form-text small text-muted">A data será escrita no PDF, mas o status continuará pendente.</div>
                        </div>

                        <div class="mb-4">
                            <label class="fw-bold small mb-1">Arquivo PDF (Individual)</label>
                            <input type="file" name="arquivo_individual" accept=".pdf" class="form-control bg-light border-0" required>
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary rounded-pill py-3 fw-bold">Salvar Anexo</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

</div>

<style>
    .fade-in-up { animation: fadeInUp 0.4s ease-out; }
    .btn-white { background-color: #fff; border: none; }
    .btn-white:hover { background-color: #f8f9fa; }
</style>