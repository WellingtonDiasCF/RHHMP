{% load static %}
<!DOCTYPE html>
<html lang="pt-br" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <title>Histórico - {{ empresa_selecionada }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>body { background-color: #f4f6f9; font-family: 'Inter', sans-serif; }</style>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark mb-4 px-4 shadow-sm">
        <a class="navbar-brand fw-bold" href="{% url 'estoque_pecas_dashboard' %}?estoque={{ empresa_selecionada }}">
            <i class="fas fa-arrow-left me-2"></i> Voltar ({{ empresa_selecionada }})
        </a>
    </nav>

    <div class="container px-4" style="max-width: 1400px;">
        <div class="card border-0 shadow-sm rounded-4">
            <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                <h5 class="fw-bold mb-0">Histórico de Movimentações: {{ empresa_selecionada }}</h5>
                
                <div class="btn-group">
                    <a href="?estoque={{ empresa_selecionada }}&tipo=" class="btn btn-outline-secondary btn-sm {% if not request.GET.tipo %}active{% endif %}">Tudo</a>
                    <a href="?estoque={{ empresa_selecionada }}&tipo=S" class="btn btn-outline-danger btn-sm {% if request.GET.tipo == 'S' %}active{% endif %}">Saídas</a>
                    <a href="?estoque={{ empresa_selecionada }}&tipo=E" class="btn btn-outline-success btn-sm {% if request.GET.tipo == 'E' %}active{% endif %}">Entradas</a>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light">
                        <tr>
                            <th class="ps-4">Data</th>
                            <th>Tipo</th>
                            <th>Peça</th>
                            <th>Filial / Destino</th>
                            <th>Técnico</th>
                            <th>Obs</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for mov in movimentacoes %}
                        <tr>
                            <td class="ps-4 small text-muted">{{ mov.data|date:"d/m/Y H:i" }}</td>
                            <td>
                                {% if mov.tipo == 'E' %}<span class="badge bg-success bg-opacity-10 text-success">Entrada</span>
                                {% elif mov.tipo == 'S' %}<span class="badge bg-danger bg-opacity-10 text-danger">Saída</span>
                                {% else %}<span class="badge bg-warning bg-opacity-10 text-warning">Baixa</span>{% endif %}
                            </td>
                            <td class="fw-bold">{{ mov.peca.nome }}</td>
                            <td>
                                <span class="badge bg-light text-dark border">{{ mov.filial }}</span>
                                <div class="small text-muted">{{ mov.destino_uso|default:"" }}</div>
                            </td>
                            <td>{{ mov.tecnico.first_name }}</td>
                            <td class="small text-muted">{{ mov.observacao|truncatechars:30 }}</td>
                        </tr>
                        {% empty %}
                        <tr><td colspan="6" class="text-center py-5 text-muted">Sem registros.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</html>